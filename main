-- Viewer
-- A comprehensive peripheral visualizer for Minecraft

-- Debug tool
local function logfile(input)
    if not fs.exists("/logs") then
        fs.mkdir("/logs")
    else
        local file = fs.open("/logs/viewer.log", "a")
        file.write(input)
        file.close()
    end
end

function getSettings()
    -- Retrieve settings from saved file, or if none exists, create settings from default list
    if not fs.exists("settings") then
        -- Retrieve up to date settings from GitHub
        logfile("Main settings not found!")
        logfile("Using default settings; Running updater")
        shell.run("install")
    else
        logfile("Main settings found!")
    end
    -- Load settings
    os.loadAPI("settings")
    logfile("Main settings loaded")
end

function getList()
    pList = {}
    for num,pName in ipairs(peripheral.getNames()) do
        logfile(num.." available peripherals found:")
        local p = peripheral.wrap(pName)
        logfile(pName)
        pList[num] = {
            name = pName,
            label = peripheral.getType(pName),
            methods = p.listMethods(),
            fluids = p.getTankInfo(),
            inventory = {
                name = p.getInventoryName(),
                max = p.getInventorySize(),
                stored = p.getAllStacks()
                },
            energy = {
                max = p.getMaxEnergyStored(),
                stored = p.getEnergyStored()
                }
            }
    end
end
-------------------------
-- Main code execution --
-------------------------
-- Clear log files
if not fs.exists("/logs") then
    fs.mkdir("/logs")
else
    if fs.exists("/logs/viewer.log") then
        fs.delete ("/logs/viewer.log")
    end
end
-- Check for dependencies
if not http then
    logfile("HTTP API not enabled! Please enable the HTTP API in the ComputerCraft config file, or ask your server administrator to do so.")
    print("HTTP API not enabled! Please enable the HTTP API in\nthe ComputerCraft config file, or ask your server/nadministrator to do so.")
    return
end

-- Load bundled APIs
os.loadAPI("settings")
os.loadAPI("gui")

----------------
-- DEBUG CODE --
----------------
getList()